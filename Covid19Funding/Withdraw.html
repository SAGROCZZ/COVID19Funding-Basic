<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <link href="css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>

    <script>
        window.onload = function () {
            if (typeof web3 == 'undefined') {
                document.getElementById("metamask").innerHTML = "you need metamask installed";
            }
            getOrgs();
        }

       function getOrgs() {

           try{
               var abi = [
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_address",
            "type": "address"
        },
        {
            "internalType": "string",
            "name": "_orgName",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "_orgCountry",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "_fundingPurpose",
            "type": "string"
        },
        {
            "internalType": "uint256",
            "name": "_amtNeeded",
            "type": "uint256"
        }
    ],
    "name": "addOrg",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
},
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_toOrg",
            "type": "address"
        },
        {
            "internalType": "uint256",
            "name": "_amount",
            "type": "uint256"
        }
    ],
    "name": "donateFunds",
    "outputs": [],
    "stateMutability": "payable",
    "type": "function"
},
{
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor"
},
{
    "anonymous": false,
    "inputs": [
        {
            "indexed": false,
            "internalType": "address",
            "name": "",
            "type": "address"
        },
        {
            "indexed": false,
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "name": "donate",
    "type": "event"
},
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_toOrg",
            "type": "address"
        }
    ],
    "name": "withdrawFunds",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
},
{
    "inputs": [],
    "name": "getBalance",
    "outputs": [
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "stateMutability": "view",
    "type": "function"
},
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_address",
            "type": "address"
        }
    ],
    "name": "getOrg",
    "outputs": [
        {
            "internalType": "string",
            "name": "",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "",
            "type": "string"
        },
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        },
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "stateMutability": "view",
    "type": "function"
},
{
    "inputs": [],
    "name": "getOrgs",
    "outputs": [
        {
            "internalType": "address[]",
            "name": "",
            "type": "address[]"
        }
    ],
    "stateMutability": "view",
    "type": "function"
},
{
    "inputs": [
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "name": "orgAccts",
    "outputs": [
        {
            "internalType": "address",
            "name": "",
            "type": "address"
        }
    ],
    "stateMutability": "view",
    "type": "function"
}
               ]
               var contractaddress = "0x4f6ae0b2e30d72bc5d164adafd734a7d9a72d8ab";
               var myabi = web3.eth.contract(abi);
               var myFunction = myabi.at(contractaddress);
              

               web3.eth.getAccounts(function (err, account) {
                  
                   myFunction.getOrg.call(account, function (aerr, aresult) {
                       if (aerr) { document.getElementById("metamask").innerHTML = aerr; }
                       if (aresult) {
                          
                           document.getElementById("xrequested").value = aresult[3] + " ETH" ;
                           document.getElementById("xraised").value = web3.fromWei(aresult[4], 'ether') + " ETH";
                       }
                   });
               });
                         
                

           }
           catch (err) {
               document.getElementById("metamask").innerHTML = err;
           }

       }


       function withdraw() {
           try{

               var abi = [
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_address",
            "type": "address"
        },
        {
            "internalType": "string",
            "name": "_orgName",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "_orgCountry",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "_fundingPurpose",
            "type": "string"
        },
        {
            "internalType": "uint256",
            "name": "_amtNeeded",
            "type": "uint256"
        }
    ],
    "name": "addOrg",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
},
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_toOrg",
            "type": "address"
        },
        {
            "internalType": "uint256",
            "name": "_amount",
            "type": "uint256"
        }
    ],
    "name": "donateFunds",
    "outputs": [],
    "stateMutability": "payable",
    "type": "function"
},
{
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor"
},
{
    "anonymous": false,
    "inputs": [
        {
            "indexed": false,
            "internalType": "address",
            "name": "",
            "type": "address"
        },
        {
            "indexed": false,
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "name": "donate",
    "type": "event"
},
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_toOrg",
            "type": "address"
        }
    ],
    "name": "withdrawFunds",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
},
{
    "inputs": [],
    "name": "getBalance",
    "outputs": [
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "stateMutability": "view",
    "type": "function"
},
{
    "inputs": [
        {
            "internalType": "address",
            "name": "_address",
            "type": "address"
        }
    ],
    "name": "getOrg",
    "outputs": [
        {
            "internalType": "string",
            "name": "",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "",
            "type": "string"
        },
        {
            "internalType": "string",
            "name": "",
            "type": "string"
        },
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        },
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "stateMutability": "view",
    "type": "function"
},
{
    "inputs": [],
    "name": "getOrgs",
    "outputs": [
        {
            "internalType": "address[]",
            "name": "",
            "type": "address[]"
        }
    ],
    "stateMutability": "view",
    "type": "function"
},
{
    "inputs": [
        {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
        }
    ],
    "name": "orgAccts",
    "outputs": [
        {
            "internalType": "address",
            "name": "",
            "type": "address"
        }
    ],
    "stateMutability": "view",
    "type": "function"
}
               ]
               var contractaddress = "0x4f6ae0b2e30d72bc5d164adafd734a7d9a72d8ab";
               var myabi = web3.eth.contract(abi);
               var myFunction = myabi.at(contractaddress);

               web3.eth.getAccounts(function (err, account) {

                   myFunction.withdrawFunds.sendTransaction(account,{ from: web3.eth.accounts[0], gas: 400000 }, function (err, result) {

                       if (err) { document.getElementById("metamask").innerHTML = err; }
                       if (result) {
                           document.getElementById("metamask").innerHTML = result;
                       }

                   });
               });

           }catch(err){
               document.getElementById("metamask").innerHTML = err;
           }
       }

    </script>

    <div id="metamask"></div>

    <div class="row" style="margin-left:10px">
        <div class="col-md-6">
            <h1 class="p-2">
                Covid-19 Funding
            </h1>

        </div>
        <div class="col-md-6">
            <ul class="nav nav-tabs">
                <li class="p-4">
                    <a class="btn btn-info" href="Index.html">Home</a>
                </li>
                <li class="p-4">
                    <a class="btn btn-info" href="Register.html">New Request</a>
                </li>
            </ul>
        </div>

        <div class="col-md-12 text-center p-4">
            <h3>Make Withdrawal</h3>
        </div>

        <div class="col-md-3 p-2">
            Amount Requested
        </div>
        <div class="col-md-6 p-2">
            <input id="xrequested" readonly="readonly" class="form-control" type="text" />
        </div>
        <div class="col-m-3 p-2"></div>

        <div class="col-md-3 p-2">
            Amount Raised
        </div>
        <div class="col-md-6 p-2">
            <input id="xraised" readonly="readonly" class="form-control" type="text" />
        </div>
        <div class="col-m-3 p-2"></div>


        <div class="col-md-3 p-2">

        </div>
        <div class="col-md-6 p-2">
            <a href="#" class="btn btn-lg btn-info" onclick="withdraw()">Withdraw Funds</a>
        </div>
        <div class="col-m-3 p-2"></div>

    </div>
</body>
</html>
